{"id":"tinyk-0aw","title":"Button click integration test (Hello World)","description":"Write a simple minitest that uses TinyK::TestWorker to: 1) Start a Tk app with a 'click me' button, 2) Programmatically invoke the button's command (simulating a click via Tcl eval), 3) The button's callback writes 'Hello world' to stdout, 4) Assert the captured stdout contains 'Hello world'. This validates the end-to-end flow: TinyK interpreter → widget creation via tcl_eval → callback dispatch → Ruby proc execution. Depends on: TinyK module existing, TestWorker rename, callback system.","status":"closed","priority":2,"issue_type":"task","owner":"jcook.rubyist@gmail.com","created_at":"2026-02-06T19:13:20.052952-06:00","created_by":"James Cook","updated_at":"2026-02-06T20:40:39.99326-06:00","closed_at":"2026-02-06T20:40:39.99326-06:00","close_reason":"test_button_click.rb passing — uses register_callback from C extension directly","dependencies":[{"issue_id":"tinyk-0aw","depends_on_id":"tinyk-v43","type":"blocks","created_at":"2026-02-06T19:13:29.467302-06:00","created_by":"James Cook"},{"issue_id":"tinyk-0aw","depends_on_id":"tinyk-ln6","type":"blocks","created_at":"2026-02-06T19:13:29.520617-06:00","created_by":"James Cook"},{"issue_id":"tinyk-0aw","depends_on_id":"tinyk-faw","type":"blocks","created_at":"2026-02-06T19:13:29.57401-06:00","created_by":"James Cook"}]}
{"id":"tinyk-0p8","title":"Clean up Dockerfile.ci-test for TinyK","description":"Strip Dockerfile.ci-test of tk-ng baggage. Remove trofs and tkdnd. Preserve tkimg and bwidget. Update paths from ext/tk to ext/tinyk, require 'tk' to require 'tinyk', etc. Goal: rake docker:test runs the TinyK test suite.","status":"closed","priority":2,"issue_type":"task","owner":"jcook.rubyist@gmail.com","created_at":"2026-02-06T21:12:03.007489-06:00","created_by":"James Cook","updated_at":"2026-02-06T21:23:54.940561-06:00","closed_at":"2026-02-06T21:23:54.940561-06:00","close_reason":"Removed trofs, tkdnd, screenshot/recording tools. Preserved bwidget and tkimg. Fixed libtiff6 dep with --force-depends. All 6 tests pass in Docker."}
{"id":"tinyk-1t2","title":"Timer support with minitest (Tcl after)","description":"Implement and test timer support in TinyK, wrapping Tcl's 'after' command. Previously known as Tk.after in tk-ng — choose an idiomatic name (e.g. TinyK#after, TinyK#timer, or TinyK.after). Should support: 1) One-shot timers: schedule a Ruby block to run after N milliseconds, 2) Nested timers: a timer callback can schedule another timer. Write a minitest that: 1) Starts a timer that prints to stdout after a delay, 2) Tests nested timers (timer A schedules timer B, both fire), 3) Asserts expected output is captured. Implementation will use 'tcl_eval(\"after \u003cms\u003e ruby_callback \u003cid\u003e\")' under the hood. Depends on callback system being in place.","status":"closed","priority":2,"issue_type":"task","owner":"jcook.rubyist@gmail.com","created_at":"2026-02-06T19:13:22.987254-06:00","created_by":"James Cook","updated_at":"2026-02-06T21:11:27.799115-06:00","closed_at":"2026-02-06T21:11:27.799115-06:00","close_reason":"app.after(ms) implemented, auto-unregisters callback. Tests for single and nested timers passing.","dependencies":[{"issue_id":"tinyk-1t2","depends_on_id":"tinyk-faw","type":"blocks","created_at":"2026-02-06T19:13:29.630131-06:00","created_by":"James Cook"}]}
{"id":"tinyk-4pz","title":"TinyK.new wraps TclTkIp — explicit interpreter instance","description":"TinyK.new should return an instance that wraps a TclTkIp interpreter. No global/default interpreter. All operations go through the instance:\n\n  app = TinyK.new\n  app.tcl_eval('button .b -text hello')\n  app.register_callback(proc { ... })\n  app.mainloop\n\nOptional block form (instance_eval'd):\n\n  app = TinyK.new do\n    command(:button, '.b', text: 'click me')\n    command(:pack, '.b')\n  end\n  app.mainloop\n\nTinyK.new handles: creating TclTkIp, requiring Tk package, withdrawing root window. Instance delegates to the underlying interp. Update existing test (test_button_click.rb) to use TinyK.new instead of raw TclTkIp. Update TestWorker server to use TinyK.new.","status":"closed","priority":1,"issue_type":"task","owner":"jcook.rubyist@gmail.com","created_at":"2026-02-06T20:42:54.896056-06:00","created_by":"James Cook","updated_at":"2026-02-06T20:47:38.34863-06:00","closed_at":"2026-02-06T20:47:38.34863-06:00","close_reason":"TinyK::App wraps TclTkIp, TestWorker and test updated to use app"}
{"id":"tinyk-4va","title":"Rework partial copy of tk-ng to be named tinyk","description":"TinyK: Thin Tcl/Tk wrapper for Ruby\n                                         \n  Extracted the C bridge layer from tk-ng (~/open_source/tk) into a new standalone project (~/open_source/tinyk). The premise: tk-ng's C layer (~2,700 lines) is solid and does the hard work — Tcl interpreter lifecycle, eval/invoke, callback dispatch, event loop, photo/font ops, Tcl 8.6/9.0 compat. The Ruby layer (~150+ files of widget classes, hash normalization, metaprogramming) is the source of complexity. TinyK aims to replace that with a minimal Ruby wrapper that passes commands directly to Tcl/Tk — no widget class hierarchy, no _symbolkey2str, no configuration abstractions. One class, generalized callbacks, users speak Tcl/Tk. Idiotmatic ruby when practical.\n\n  Bootstrapped with code from tk-ng:\n  - C extension files\n  - Dockerfile.ci-test (multi-stage, Tcl 8.6/9.0 support)\n  - Rakefile (needs trimming — currently has all tk-ng tasks/verbiage)\n  - Gemspec/Gemfile (needs rename maybe)\n  - Test harness (tk_test_helper, tk_worker, simplecov_config — needs adaptation for thin API)\n\n  Next steps: Review gemspec, strip Rakefile to essentials, write the thin Ruby wrapper (lib/tinyk.rb), adapt test harness to not depend\n  on tk-ng's widget classes.\n","status":"open","priority":2,"issue_type":"epic","owner":"jcook.rubyist@gmail.com","created_at":"2026-02-06T19:05:47.962121-06:00","created_by":"James Cook","updated_at":"2026-02-06T19:07:48.798879-06:00"}
{"id":"tinyk-51z","title":"Pull in Ractor/background work code from tk-ng","description":"Port the Ractor and background work infrastructure from tk-ng (~/open_source/tk-ng). This includes thread-safe interpreter access, queue_for_main, and Ractor-based patterns for running work off the Tk main thread. The C extension already has queue_for_main and on_main_thread? — this is the Ruby-side support code.","status":"open","priority":2,"issue_type":"task","owner":"jcook.rubyist@gmail.com","created_at":"2026-02-06T20:38:09.903636-06:00","created_by":"James Cook","updated_at":"2026-02-06T20:38:09.903636-06:00"}
{"id":"tinyk-b17","title":"Widget registry via Create/Destroy event tracking","description":"TinyK::App listens to \u003cCreate\u003e and \u003cDestroy\u003e events on all widgets by default, maintaining a registry of live widgets keyed by path.\n\nRegistry stores path =\u003e {class: 'Button', parent: '.'} etc.\n\nConvenience methods:\n  app.widgets         # =\u003e hash of all live widgets\n  app.widgets['.b']   # =\u003e {class: 'Button', parent: '.'}\n\nOn \u003cCreate\u003e: query winfo class and winfo parent, add to registry.\nOn \u003cDestroy\u003e: remove from registry.\n\nCan be disabled: TinyK::App.new(track_widgets: false)\n\nDepends on command() helper being in place (already done).","status":"closed","priority":2,"issue_type":"feature","owner":"jcook.rubyist@gmail.com","created_at":"2026-02-06T20:56:04.051332-06:00","created_by":"James Cook","updated_at":"2026-02-06T21:06:01.128385-06:00","closed_at":"2026-02-06T21:06:01.128385-06:00","close_reason":"Widget registry implemented via trace add execution on widget commands + Destroy bind. Tracks path, class, parent. Disabled with track_widgets: false. Future: allow registering custom widget commands for tracking."}
{"id":"tinyk-faw","title":"Callback system for TinyK","description":"Implement TinyK's callback system — the Ruby-side mechanism for registering Ruby procs that Tcl can invoke. The C extension already provides TclTkIp#register_callback(proc) which returns an ID string, and the Tcl command 'ruby_callback \u003cid\u003e ?args..?' to invoke it. TinyK needs a clean Ruby API on top of this, e.g. TinyK#on_callback or similar, that: 1) Accepts a Ruby block/proc, 2) Registers it with the interpreter via register_callback, 3) Returns a Tcl command string that can be used in widget -command options. This is the foundation for button clicks, binds, traces, and timers (Tcl 'after' uses callbacks too).","status":"closed","priority":2,"issue_type":"task","owner":"jcook.rubyist@gmail.com","created_at":"2026-02-06T19:13:21.639334-06:00","created_by":"James Cook","updated_at":"2026-02-06T21:11:27.742879-06:00","closed_at":"2026-02-06T21:11:27.742879-06:00","close_reason":"Callback system working via C extension register_callback + auto-registration in command() and after()","dependencies":[{"issue_id":"tinyk-faw","depends_on_id":"tinyk-v43","type":"blocks","created_at":"2026-02-06T19:13:29.41269-06:00","created_by":"James Cook"}]}
{"id":"tinyk-ln6","title":"Rename TkWorker to TinyK::TestWorker","description":"Rename the test harness class from TkWorker to TinyK::TestWorker. Files affected: test/tk_worker.rb (rename to test/tinyk_test_worker.rb or similar), test/tk_test_helper.rb (update references). The Server inner class currently does 'require tk' and uses TkRoot — this needs to be adapted to use TinyK's thin API instead (TclTkIp directly). Update all references in the test helper (assert_tk_app, etc.) to use the new class name.","status":"closed","priority":2,"issue_type":"task","owner":"jcook.rubyist@gmail.com","created_at":"2026-02-06T19:13:18.660805-06:00","created_by":"James Cook","updated_at":"2026-02-06T20:38:42.604938-06:00","closed_at":"2026-02-06T20:38:42.604938-06:00","close_reason":"TkWorker renamed to TinyK::TestWorker, test helper updated","dependencies":[{"issue_id":"tinyk-ln6","depends_on_id":"tinyk-v43","type":"blocks","created_at":"2026-02-06T19:13:29.35633-06:00","created_by":"James Cook"}]}
{"id":"tinyk-ssu","title":"Implement TinyK.command(*args, **kwargs) helper","description":"Generic Ruby-friendly helper that translates Ruby calls into Tcl command strings and evals them.\n\nAPI: command(cmd, *args, **kwargs)\n\nExamples:\n  command(:button, '.b', text: 'click me', command: proc { puts 42 })\n  command(:pack, '.b', side: 'left', fill: 'x')\n  command(:bind, '.b', '\u003cEnter\u003e', proc { ... })\n  command(:insert, '.t', 'end', 'hello')\n  command(:configure, '.b', text: 'new label')\n\nMechanics:\n- cmd and positional args are joined as-is\n- kwargs become -key value pairs\n- Proc/block values are auto-registered via interp.register_callback and replaced with 'ruby_callback \u003cid\u003e'\n- Curly-brace quoting for string values\n- No validation of commands or options — Tcl handles that and gives good errors\n- Uses tcl_invoke under the hood (not tcl_eval) to avoid injection from user values\n\nThis is the main convenience layer TinyK provides over raw tcl_eval/tcl_invoke.","status":"closed","priority":2,"issue_type":"feature","owner":"jcook.rubyist@gmail.com","created_at":"2026-02-06T20:37:49.63145-06:00","created_by":"James Cook","updated_at":"2026-02-06T20:51:33.489277-06:00","closed_at":"2026-02-06T20:51:33.489277-06:00","close_reason":"command() helper implemented with auto callback registration, test updated","dependencies":[{"issue_id":"tinyk-ssu","depends_on_id":"tinyk-faw","type":"blocks","created_at":"2026-02-06T20:38:02.051541-06:00","created_by":"James Cook"}]}
{"id":"tinyk-v43","title":"Define TinyK module in lib/tinyk.rb","description":"Create lib/tinyk.rb that defines the TinyK module/class. This is the thin Ruby wrapper over the C extension (TclTkIp/TclTkLib). For now, just define the module and require the C extension (tcltklib). Not much else yet — the callback system and other features will be added in separate tasks.","status":"closed","priority":2,"issue_type":"task","owner":"jcook.rubyist@gmail.com","created_at":"2026-02-06T19:13:17.110559-06:00","created_by":"James Cook","updated_at":"2026-02-06T20:38:42.543822-06:00","closed_at":"2026-02-06T20:38:42.543822-06:00","close_reason":"lib/tinyk.rb created with TinyK module and VERSION"}
